"use strict";(self.webpackChunkecommerce_frontend=self.webpackChunkecommerce_frontend||[]).push([[63],{63:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var a=r(2555),s=r(5043),n=r(3393),c=r(3216),i=r(2224),o=r(5016),d=r(8045),l=r(579);const u={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE_URL,h=()=>{const e=(0,n.useStripe)(),t=(0,n.useElements)(),{cartItems:r,clearCart:h}=(0,i._)(),{user:m,makeAuthenticatedRequest:p,loading:y}=(0,o.A)(),x=(0,c.Zp)(),{showToast:g}=(0,d.Y6)(),[j,v]=(0,s.useState)(!1),[f,C]=(0,s.useState)(null),[S,_]=(0,s.useState)({street:"",city:"",state:"",zipCode:"",country:""});(0,s.useEffect)((()=>{y||m||(g("Please log in to complete your order","error"),x("/login?redirect=/checkout"))}),[m,y,x,g]);const A=r.reduce(((e,t)=>e+t.product.price*t.quantity),0);return y?(0,l.jsx)("div",{className:"checkout",children:(0,l.jsx)("div",{className:"container",children:(0,l.jsx)("h1",{children:"Loading..."})})}):m?(0,l.jsx)("div",{className:"checkout",children:(0,l.jsxs)("div",{className:"container",children:[(0,l.jsx)("h1",{children:"Checkout"}),f&&(0,l.jsx)("div",{className:"error-message",style:{marginBottom:"1rem"},children:f}),(0,l.jsxs)("div",{className:"checkout-content",children:[(0,l.jsxs)("div",{className:"order-summary",children:[(0,l.jsx)("h3",{children:"Order Summary"}),r.map((e=>(0,l.jsxs)("div",{className:"order-item",children:[(0,l.jsxs)("span",{children:[e.product.name," x ",e.quantity]}),(0,l.jsxs)("span",{children:["$",(e.product.price*e.quantity).toFixed(2)]})]},e.id))),(0,l.jsx)("div",{className:"order-total",children:(0,l.jsxs)("strong",{children:["Total: $",A.toFixed(2)]})})]}),(0,l.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),C(null),e&&t){if(!m)return C("Please log in to complete your order"),void x("/login?redirect=/checkout");if(0===r.length)return C("Your cart is empty"),void x("/cart");v(!0);try{const r=await p("".concat(u,"/payment/create-intent"),{method:"POST",body:JSON.stringify({amount:Math.round(100*A)})}),{client_secret:a}=r;if(!a)throw new Error("Failed to create payment intent");const{error:c,paymentIntent:i}=await e.confirmCardPayment(a,{payment_method:{card:t.getElement(n.CardElement)}});if(c)throw new Error(c.message);if("succeeded"!==i.status)throw new Error("Payment was not completed successfully");try{await p("".concat(u,"/orders"),{method:"POST",body:JSON.stringify({shipping_address:S,payment_method:"card",payment_intent_id:i.id})});h(),g("Order placed successfully!","success"),x("/orders")}catch(s){C("Order creation failed: ".concat(s.message)),g("Payment processed but order creation failed. Please contact support.","error")}}catch(f){C(f.message||"Checkout failed. Please try again."),g(f.message||"Checkout failed","error")}finally{v(!1)}}else C("Payment system not ready. Please try again.")},className:"checkout-form",children:[(0,l.jsxs)("div",{className:"shipping-section",children:[(0,l.jsx)("h3",{children:"Shipping Address"}),(0,l.jsx)("input",{type:"text",placeholder:"Street Address",value:S.street,onChange:e=>_((0,a.A)((0,a.A)({},S),{},{street:e.target.value})),required:!0}),(0,l.jsx)("input",{type:"text",placeholder:"City",value:S.city,onChange:e=>_((0,a.A)((0,a.A)({},S),{},{city:e.target.value})),required:!0}),(0,l.jsx)("input",{type:"text",placeholder:"State",value:S.state,onChange:e=>_((0,a.A)((0,a.A)({},S),{},{state:e.target.value})),required:!0}),(0,l.jsx)("input",{type:"text",placeholder:"Zip Code",value:S.zipCode,onChange:e=>_((0,a.A)((0,a.A)({},S),{},{zipCode:e.target.value})),required:!0}),(0,l.jsx)("input",{type:"text",placeholder:"Country",value:S.country,onChange:e=>_((0,a.A)((0,a.A)({},S),{},{country:e.target.value})),required:!0})]}),(0,l.jsxs)("div",{className:"payment-section",children:[(0,l.jsx)("h3",{children:"Payment Information"}),(0,l.jsx)("div",{className:"card-element",children:(0,l.jsx)(n.CardElement,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}}}}})})]}),(0,l.jsx)("button",{type:"submit",disabled:!e||j||0===r.length,className:"btn btn-primary",children:j?"Processing...":"Pay $".concat(A.toFixed(2))})]})]})]})}):(0,l.jsx)("div",{className:"checkout",children:(0,l.jsx)("div",{className:"container",children:(0,l.jsx)("h1",{children:"Redirecting to login..."})})})}}}]);
//# sourceMappingURL=63.31b2cec8.chunk.js.map